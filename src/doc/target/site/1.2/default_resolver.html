<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Jul 16, 2012
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cube Project - Cube Project Home Page</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido.min.js"></script>

    
      <meta name="author" content="Bassem Debbabi" />
    <meta name="Date-Revision-yyyymmdd" content="20120716" />
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../index.html" id="bannerLeft">
                                                                                                <img src="../images/cube.png"  alt="Cube Project"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="projectVersion">Version: 1.2</li>
              
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2012-07-16</li> 
            
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                                    <h3>Project Links</h3>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="../1.2/getting_started.html" title="Getting started">Getting started</a>
            </li>
                  <li class="none">
                          <a href="../1.2/doc.html" title="Documentation">Documentation</a>
            </li>
                  <li class="none">
                          <a href="../download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../license.html" title="License">License</a>
            </li>
          </ul>
                        <h3>Catalog</h3>
                  <ul>
                  <li class="none">
                          <a href="../1.2/managed_elements.html" title="Managed Elements">Managed Elements</a>
            </li>
                  <li class="none">
                          <a href="../1.2/constraints.html" title="Constraints">Constraints</a>
            </li>
                  <li class="none">
                          <a href="../1.2/extensions.html" title="Extensions">Extensions</a>
            </li>
          </ul>
                        <h3>Other Links</h3>
                  <ul>
                  <li class="none">
                          <a href="http://cube.imag.fr/wiki" class="externalLink" title="Wiki">Wiki</a>
            </li>
          </ul>
                      
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <p><a href="./doc.html">Documentation</a> &gt; <a href="./agent.html">Cube Agent</a></p><div class="section"><h2>Default Resolver<a name="Default_Resolver"></a></h2><p>It implements the <a class="externalLink" href="https://github.com/AdeleResearchGroup/cube/blob/master/src/cube-core/src/main/java/fr/liglab/adele/cube/agent/IResolver.java">IResolver</a> interface of the <a href="./agent.html">Cube Agent</a>.</p><p>The Cube Agent call the <tt>resolveNewInstance</tt> method for each newly added instance to the Runtime Model.</p><p>In this page, we give a detailed information about the algorithms behind our default implementation of the Resolver module (we call it after simply <i>Resolver</i> and not <i>Default Resolver</i>).</p><div class="section"><h3>Main concepts<a name="Main_concepts"></a></h3><ul><li><b>Resolution Graph</b>: When the Cube Agent calls the Resolver to resolve a newly created instance, this last one creates a <i>Resolution Graph</i>. A Resolution Graph <tt>RG</tt> is a graph where vertices are typed variables (corresponding to instances of archetype Types) and the arcs are constraints (corresponding to archetype Constraints). <div><pre>RG = &lt;V, C&gt;</pre></div></li><li><b>V</b>: a set of typed variables where each one holds a null value or a one of the set of possible runtime instances of the corresponding archetype Managed Elements. Each variable holds also a historical table of the already tested values.</li><li><b>C</b>: a set of constraintes between the variables V. Each constraint has one or more of the following functions of capabilities: <tt>find</tt>, <tt>check</tt> and/or <tt>perform</tt>. These capabilities are implemented by constraint's corresponding <b>ConstraintResolver</b>.</li></ul><div class="section"><h4>Graphical Syntax of the Resolution Graph<a name="Graphical_Syntax_of_the_Resolution_Graph"></a></h4><img src="./images/graphical_syntax.png" alt="graphical_syntax" /></div></div><div class="section"><h3>Initial configuration <a name="Initial_configuration"></a></h3><p>First, a new Resolution Graph is created with only one Variable containing the newly created instance as value.</p></div><div class="section"><h3>Algorithm<a name="Algorithm"></a></h3><div class="section"><h4>R&#xe9;sum&#xe9;<a name="Rsum"></a></h4><ul><li>When a new instance is created, the Resolver builds a <i>Resolution Graph</i> for it. At first, this graph has only one variable representing the newly created instance (which is UNRESOLVED when created).</li><li>then, it tries to validate this instance against its specified archetype constraints. it adds to the initial variable of the graph all the direct related constraints (which provides the <tt>check</tt> capability).</li><li>the Resolver loops the different check constraints. The examined variable (and so it representing instance) will be VALID if all the constraints returns TRUE (In future work, we will have a <a class="externalLink" href="https://github.com/AdeleResearchGroup/cube/issues/10">non mandatory constraints</a> so that the instance will be VALID if all it mandatory constraints are true).</li><li>When the Resolver calls the <tt>check</tt> function of each constraint:<ul><li>it first tries to initialize the related variable value directly from the constrained variable. This will optimize the search algorithm.</li><li>if the related variable always null:<ul><li>the resolved starts first by looking for a value for this related constraint.<ul><li>it add to it all its direct related archetype constraints that provides the <tt>find</tt> capability.</li><li>by order of priority, it calls each one's specific resolver to find a value for the current variable.</li></ul></li><li>if value found, go next.. </li></ul></li><li>if the related variable has a value: <ul><li>if the current constrained variable is in the UNRESOLVED state, the Resolver executes the <tt>perform</tt> function of the constraint (if the constraint provides this capability).</li></ul></li><li>before calling the <tt>check</tt> function of the constraint's specific resolver, it first checks the related variable if it is always VALID. </li></ul></li></ul></div><div class="section"><h4>Details<a name="Details"></a></h4><p><b>Resolver</b></p><div class="source"><pre class="prettyprint">on newInstance(Instance i, RuntimeModel rm, Archetype arch)
  RG = createResolutionGraph(i)
  resolved = resolveVar(RG.topVariable, rm, arch)
  if (resolved == true) then
    validateSolution(RG)
  else
    log &quot;no solution found&quot;
  end if</pre></div><p><b>Variable</b></p><div class="source"><pre class="prettyprint">resolveVar(Variable v, RuntimeModel rm, Archetype arch)
  /* if v has no value, tries to find a value for it */
  if (v is null) then
    value = findValueForVariable(v, rm)
    if (value is null) then 
      return false /* not resolved */
    end if    
  end if
  /* add the checking constraints related to v */
  addCheckingConstraints(v, Archetype)
  for each Constraint c of v.constraints do    
    ck = checkConstraint(c, rm)
    /* if only one constraint is not satisfied, return false */
    if (ck is FALSE) then
      return false /* not resolved */
    end if  
  end for  </pre></div><div class="source"><pre class="prettyprint">findValueForVariable(Variable v, RuntimeModel rm)
  
</pre></div><p><b>Constraint</b></p><div class="source"><pre class="prettyprint">checkConstraint(Constraint c, RuntimeModel rm) 
  
</pre></div></div></div><div class="section"><h3>Running Example<a name="Running_Example"></a></h3><div class="section"><h4>Archetype<a name="Archetype"></a></h4><div class="source"><pre class="prettyprint">&lt;cube xmlns:core=&quot;fr.liglab.adele.cube.core&quot;&gt;
  &lt;archetype id=&quot;org.example.cube&quot; name=&quot;Cube example&quot; version=&quot;1.0&quot;&gt;

    &lt;types&gt;
      &lt;core:scope id=&quot;CITY&quot;/&gt;    
      &lt;core:node id=&quot;SERVER&quot;/&gt;
      &lt;core:node id=&quot;GATEWAY&quot;/&gt;
      &lt;core:component id=&quot;GP&quot;/&gt;
      &lt;core:component id=&quot;HC&quot;/&gt;
      &lt;core:component id=&quot;CA&quot;/&gt;
    &lt;/types&gt;

    &lt;constraints&gt;
      &lt;variables&gt;
        &lt;var id=&quot;city&quot; type=&quot;CITY&quot;/&gt;
        &lt;var id=&quot;server&quot; type=&quot;SERVER&quot;/&gt;
        &lt;var id=&quot;gateway&quot; type=&quot;GATEWAY&quot;/&gt;
        &lt;var id=&quot;gp&quot; type=&quot;GP&quot;/&gt;
        &lt;var id=&quot;hc&quot; type=&quot;HC&quot;/&gt;
        &lt;var id=&quot;ca&quot; type=&quot;CA&quot;/&gt;                        
      &lt;/variables&gt;
      &lt;core:on-node v1=&quot;gp&quot; v2=&quot;gateway&quot;/&gt;
      &lt;core:on-same-node v1=&quot;gp&quot; v2=&quot;hc&quot; /&gt;      
      &lt;core:connect v1=&quot;gp&quot; v2=&quot;hc&quot;/&gt;
        &lt;core:on-node v1=&quot;hc&quot; v2=&quot;gateway&quot; priority=&quot;1&quot;/&gt;
          &lt;core:in-scope v1=&quot;gateway&quot; v2=&quot;city&quot;/&gt;
        &lt;core:self-create-locally v=&quot;hc&quot; priority=&quot;2&quot;/&gt;          
        &lt;core:connect v1=&quot;hc&quot; v2=&quot;ca&quot; priority=&quot;3&quot;/&gt;
          &lt;core:in-same-scope v1=&quot;hc&quot; v2=&quot;ca&quot;/&gt;
          &lt;core:on-node v1=&quot;ca&quot; v2=&quot;server&quot;/&gt;                  
            &lt;core:in-scope v1=&quot;server&quot; v2=&quot;city&quot;/&gt;      
              &lt;core:managed-scope v=&quot;city&quot;/&gt;      
    &lt;/constraints&gt;
    &lt;global-config&gt;
      &lt;core:topscopeleader url=&quot;cube://localhost:12001&quot;/&gt;
    &lt;/global-config&gt;
  &lt;/archetype&gt;
&lt;/cube&gt;</pre></div></div><div class="section"><h4>Testing<a name="Testing"></a></h4><p>We have two nodes <tt>home1</tt> of type <tt>GATEWAT</tt> and <tt>server1</tt> of type <tt>SERVER</tt>, and they are on the same scope <tt>grenoble</tt> of type <tt>CITY</tt>.</p><p>When started we will have the following Runtime Models (See <a href="./getting_started_scopes.html">Scope Constitution</a> Getting started tutorial for more information about scopes constitution):</p><img src="./images/uc0.png" alt="uc0" /><hr /><p>On the <tt>server1</tt> node, we will create a new instance of type CA, using the <a href="./commandline.html">CommandLine</a> tool:</p><div><pre> g! newi CA</pre></div><p>Initially, the new instance is <tt>UNRESOLVED</tt> and the Resolver tries to validate it. It creates a new <i>Resolution Graph</i> with only one variable for the moment containing this newly created instance.</p><img src="./images/uc1.png" alt="uc1 " /><p>When Resolving the variable <tt>x1:CA</tt>, </p><ul><li>it checks all its direct related constraints specified on the archetype (that provides the <tt>check</tt> capability). In this case, there is only the <tt>on-node</tt> constraint.<ul><li>befor checking the &quot;on-node&quot; constraint, the resolver tries to initialize the value of its related variable <tt>x2</tt> directly from the <tt>x1</tt> value. As the &quot;ca&quot; instance when created locally, it aleady has as node the local node instance <tt>ca.node = server1</tt>, this will initialize the <tt>x2</tt> variable with the value <tt>server1</tt>.<img src="./images/uc2.png" alt="uc2" /></li><li>then, it executes the <tt>perform</tt> function of the <tt>on-node</tt>'s constraint resolver. this will add <tt>ca</tt> to the list of components of <tt>server1</tt>, and for <tt>ca</tt> it has already the <tt>server1</tt> as node.</li><li>now, the resolver will tries to check the <tt>on-node</tt> constraint. <ul><li>before calling the <tt>check</tt> function of the <tt>on-node</tt>'s constraint resolver, the Resolver should first make sure that the <tt>server1</tt> instance value is always VALID (because the Resolver has already change it when calling the <tt>perform</tt> function).</li><li>By checking the <tt>x2:Server</tt> variable, the resolver will:<ul><li>retrieve the &quot;checking&quot; constraints related to the <tt>SERVER</tt> type (In future work, we will optimize this step by adding only the constraints related to the changed part of the instance). There is only the <tt>in-scope</tt> constraint. The Resolver will also initialize its related variable directly from the actual one (as described before).</li><li>It checks the <tt>in-scope</tt> constraint which returns TRUE, so the <tt>x2</tt> remains VALID, after that, it returns back to check the <tt>on-node</tt> constraints which returns also TRUE. And so, all the constraints related to <tt>ca</tt> are satisfied. The <tt>ca</tt> became VALID.</li></ul></li></ul></li></ul></li></ul><img src="./images/uc4.png" alt="uc4 " /><hr /><p>On the <tt>home1</tt> node, we will create a new instance of type <tt>GP</tt>:</p><div><pre> g! newi GP</pre></div><p>As in the first case, the newly created instance is UNRESOLVED and the Resolver tries to validate it against its related constraints.</p><img src="./images/uc5.png" alt="uc5 " /><ul><li>it retrieves its related &quot;checking&quot; constraints from the archetype.<ul><li>in this case, there is <tt>on-node</tt>, <tt>connect</tt> and <tt>on-same-node</tt> constraints.</li></ul></li></ul><img src="./images/uc6.png" alt="uc6" /><ul><li>The resolver will now check each constraint (In the actual implementation, they are checked in no implicit order!)<ul><li>befor checking the &quot;on-node&quot; constraint, the resolver tries to initialize the value of <tt>x2</tt> directly from the <tt>x1</tt>. As the &quot;gp&quot; when created locally it has aleady as node the local node instance (<tt>gp.node = home1</tt>), this will initialize the <tt>x2</tt> variable with the value <tt>home1</tt>. Hence, checking the <tt>on-node</tt> is similar at what was described befor for the first part on this example. We will not detail it again here.<img src="./images/uc6bis.png" alt="uc6bis " /></li><li>Now, the resolver move to the next constraint to check: <tt>connect</tt>. <ul><li>Before checking the <tt>connect</tt> constraint, the resolver tries as always to initialize the related variable (<tt>x3</tt>) value directly from the constrained variable (<tt>x1</tt>) value. In this case, no value is found (gp is not yet connnected to any instance of type HC). </li><li>As no value was initialized, the Resolver should <b>find</b> a value for <tt>x3</tt>. <ul><li>It retrieves its &quot;finding&quot; constraints from the archetype (it founds (1) <tt>on-node</tt>, (2) <tt>self-create-locally</tt> and (3) <tt>connect</tt>)<img src="./images/uc7.png" alt="uc7" /></li><li>The Resolver starts looking for a value for <tt>x3</tt> from its finding constraints (<b>by priority order</b> as described on the archetype).<ul><li>it first calls the <tt>find</tt> method of the <tt>on-node</tt>'s constraint resolver. This last one does not found an <tt>HC</tt> instance on the <tt>home1</tt> Node's instance. </li><li>second it calls the &quot;find&quot; method of the <tt>self-create-locally</tt>'s constraint resolver. This last one will create explicitly an <tt>HC</tt> instance and return it to the resolver.<img src="./images/uc8.png" alt="uc8 " /></li></ul></li></ul></li><li>As the resolver has found a value for <tt>x3</tt>, it will now execute the <tt>perform</tt> function of <tt>connect</tt>'s constraint resolver (between <tt>x1</tt> and <tt>x3</tt>). This will connect the two <a href="./componentinstance.html">Component instances</a>.</li><li>And then, it will now <b>checks</b> this <tt>connect</tt> constraint (between <tt>x1</tt> and <tt>x3</tt>).<ul><li>As the <tt>x3</tt> value is UNRESOLVED, its first start by checking this variable.<ul><li>It retrieves its checking constraints. In this case there are two constraints: <tt>on-node</tt> and <tt>connect</tt>.</li><li>The <tt>on-node</tt> constraint resolver returns TRUE (as described before). </li><li>When the Resolver tries to check the <tt>connect</tt> constraint (between <tt>x3</tt> and <tt>x5</tt>) :<ul><li>It can not initialize the <tt>x5</tt> value directly from the constrained variable <tt>x3</tt></li><li>It tries to <b>find</b> a value for <tt>x5</tt>. It retrieves all its findind constraints from the archetype. It founds only one: <tt>on-node</tt>. Again, the related variable <tt>x6</tt> is null, the Resolver tries before to find a value for it. It retreives all its finding constraints. On <tt>in-scope</tt> in this case. <img src="./images/uc9.png" alt="uc9" /></li><li>The <tt>in-scope</tt>'s constraint resolver return the <tt>server1</tt> value for <tt>x6</tt>. This is the only instance of node of type <tt>Server</tt> in the <tt>grenoble</tt> scope.</li><li>The <tt>on-node</tt>'s constraint resolver return the <tt>ca</tt> instance found on the <tt>server1</tt> node. (this is a distributed finding operation. We will explain it in detail!)<img src="./images/uc10.png" alt="uc10 " /></li><li>Finally, the Resolver, perform the connect (between x3 and x5) and checks. All will be TRUE.</li></ul></li></ul></li></ul></li></ul></li></ul></li><li>When validating this solution, a remote validation operation will have place between the two agents. </li></ul></div></div></div>
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2012.
          All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
