<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Jul 16, 2012
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cube Project - Cube Project Home Page</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido.min.js"></script>

    
      <meta name="author" content="Bassem Debbabi" />
    <meta name="Date-Revision-yyyymmdd" content="20120716" />
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../index.html" id="bannerLeft">
                                                                                                <img src="../images/cube.png"  alt="Cube Project"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="projectVersion">Version: 1.2</li>
              
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2012-07-16</li> 
            
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                                    <h3>Project Links</h3>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="../1.2/getting_started.html" title="Getting started">Getting started</a>
            </li>
                  <li class="none">
                          <a href="../1.2/doc.html" title="Documentation">Documentation</a>
            </li>
                  <li class="none">
                          <a href="../download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="../license.html" title="License">License</a>
            </li>
          </ul>
                        <h3>Catalog</h3>
                  <ul>
                  <li class="none">
                          <a href="../1.2/managed_elements.html" title="Managed Elements">Managed Elements</a>
            </li>
                  <li class="none">
                          <a href="../1.2/constraints.html" title="Constraints">Constraints</a>
            </li>
                  <li class="none">
                          <a href="../1.2/extensions.html" title="Extensions">Extensions</a>
            </li>
          </ul>
                        <h3>Other Links</h3>
                  <ul>
                  <li class="none">
                          <a href="http://cube.imag.fr/wiki" class="externalLink" title="Wiki">Wiki</a>
            </li>
          </ul>
                      
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <p><a href="./getting_started.html">Getting started</a> &gt;</p><div class="section"><h2>Self-Connecting Components<a name="Self-Connecting_Components"></a></h2><p>In this tutorial, we will show you how to specify constraints and goals on how the components should be connected.</p><p>We will just manipulate Cube Abstract Components. All what is applied to these components can be projected to real technology-specific components (using <a href="./extensions.html">Cube Extensions</a>).</p><ul><li><a href="#Where_to_find_and_test_the_examples">Where to find and test the examples</a></li><li><a href="#The_initial_configuration">The initial configuration</a></li><li><a href="#Test_case_1">Test case 1</a><ul><li><a href="#The_Archetype">The Archetype</a></li><li><a href="#Testing">Testing</a></li></ul></li><li><a href="#Test_case_2">Test case 2</a><ul><li><a href="#The_Archetype">The Archetype</a></li><li><a href="#Testing">Testing</a></li></ul></li><li><a href="#Test_case_3">Test case 3</a><ul><li><a href="#The_Archetype">The Archetype</a></li><li><a href="#Testing">Testing</a></li></ul></li><li><a href="#Test_case_4">Test case 4</a><ul><li><a href="#The_Archetype">The Archetype</a></li><li><a href="#Testing">Testing</a></li></ul></li></ul><div class="section"><h3>Where to find and test the examples<a name="Where_to_find_and_test_the_examples"></a></h3><p>From the <a href="../download.html">downloaded</a> distribution of Cube, in the following directory:</p><div><pre>demo/getting_started/connecting_components</pre></div></div><div class="section"><h3>The initial configuration<a name="The_initial_configuration"></a></h3><p>In this tutorial, we will use only one Node (<tt>mynode</tt>). The Cube Agent controling this node is configured with two extensions: the core extension and the <a href="./monitoring_extension.html">internal monitoring extension</a>. The first one contains the core model types (components, nodes and scopes) and the core constraints and their resolvers, while the second one allows us to see, in graphical interface, the structure of the application's part (components).</p><p>have a look to the agent config file located here:</p><div><pre>demo/getting_started/connecting_components/mynode/load/cube.agent</pre></div><div class="source"><pre class="prettyprint">&lt;cube&gt;
  &lt;agent&gt;
    &lt;host value=&quot;localhost&quot;/&gt;
    &lt;port value=&quot;38000&quot;/&gt;
    &lt;archetypeUrl value=&quot;file:../demo1.arch&quot;/&gt;

    &lt;extensions&gt;
      &lt;extension id=&quot;fr.liglab.adele.cube.core&quot;/&gt;
      &lt;extension id=&quot;fr.liglab.adele.cube.monitoring&quot;/&gt;
    &lt;/extensions&gt;
  &lt;/agent&gt;
&lt;/cube&gt;</pre></div><p>In this tutorial, we will change the <tt>archetypeUrl</tt> each time we want to test some thing different. This requires to restart the node. (It is already envisaged to have the <a class="externalLink" href="https://github.com/AdeleResearchGroup/cube/issues/3">dynamic upgrade of archetypes</a>, but not yet implemented!)</p></div><div class="section"><h3>Test case 1<a name="Test_case_1"></a></h3><div class="section"><h4>The Archetype<a name="The_Archetype"></a></h4><p>First, we will test the following <a href="./archetype.html">archetype</a> definition (<tt>demo1.arch</tt>):</p><div class="source"><pre class="prettyprint">&lt;cube xmlns:core=&quot;fr.liglab.adele.cube.core&quot;&gt;
  &lt;archetype id=&quot;net.debbabi.cube.demo.connect&quot; name=&quot;Connecting Components Tutorial 1&quot; version=&quot;1.0&quot;&gt;

    &lt;types&gt;
      &lt;core:component id=&quot;A&quot;/&gt;
      &lt;core:component id=&quot;B&quot;/&gt;
    &lt;/types&gt;

    &lt;constraints&gt;
      &lt;variables&gt;
        &lt;var id=&quot;va&quot; type=&quot;A&quot;/&gt;
        &lt;var id=&quot;vb&quot; type=&quot;B&quot;/&gt;
      &lt;/variables&gt;
      &lt;core:connect v1=&quot;va&quot; v2=&quot;vb&quot;/&gt;
    &lt;/constraints&gt;

  &lt;/archetype&gt;
&lt;/cube&gt;</pre></div><p>We have specified two component types <tt>A</tt> and <tt>B</tt>. All the instances of component type <tt>A</tt> are constrained with the <tt>connect</tt> constraint with instances of component type <tt>B</tt>. That is, each instance A should be connected to another instance B (and <b>not</b> vice versa!). </p></div><div class="section"><h4>Testing<a name="Testing"></a></h4><p>Launch the cube agent from:</p><div><pre>demo/getting_started/connecting_components/mynode</pre></div><p>Within Linux shell, type the following command. (<a class="externalLink" href="https://github.com/AdeleResearchGroup/cube/issues/1">Other Operating systems</a>)</p><div><pre>  $ sh ./init.sh
      _______              
     /|      |             
    | | CUBE |...Starting the CUBE Platform  
    | |______|   1.2.0-SNAPSHOT
    |/______/              
  
  ____________________________
  Welcome to Apache Felix Gogo

  [INFO] ... starting the CubeAgent: cube://localhost:38000
  g! </pre></div><p>After the startup of the node, you will have the internal monitoring GUI opened.</p><p>Create a component instance of type A (using <tt>newi</tt> command), and then show the Runtime Model content (using <tt>rm</tt> command).</p><div><pre> g! newi A
 g! rm
 --------------------------------------------------------------------------
 - cube://localhost:38000/objects/0 (fr.liglab.adele.cube.core.component:A) [UNRESOLVED]
        localId: 0
        Node: null
        InComps:
        OutComps:
 --------------------------------------------------------------------------</pre></div><p>You notice that A is <tt>unresolved</tt> due to the non respect of the <tt>connect</tt> constraint. That is, A instance is created but when resolving it, it is not connected to any instance B.</p><p>Create a new instance B.</p><div><pre> g! newi B
 g! rm
 --------------------------------------------------------------------------
 - cube://localhost:38000/objects/1 (fr.liglab.adele.cube.core.component:B) [VALID]
        localId: 1
        Node: null
        InComps:
        OutComps:

- cube://localhost:38000/objects/0 (fr.liglab.adele.cube.core.component:A) [UNRESOLVED]
        localId: 0
        Node: null
        InComps:
        OutComps:
 --------------------------------------------------------------------------</pre></div><p>The component instance B is created and is valid. This is true because no constraint was specified on B instances. </p><p>You notice that A is always <tt>unresolved</tt> despite the availability of the B instance (see the description of this <a href="#a">issue on the Cube project</a>).</p><p>Now, if you create a new instance of type A, it will always remains <tt>unresolved</tt>, this is because we have not mentionned in the archetype how to find this instance of type B which A is connected to. This should be specified manually on the archetype, but in future versions <a class="externalLink" href="https://github.com/AdeleResearchGroup/cube/issues/7">we envisage to do that automatically</a>.</p></div></div><div class="section"><h3>Test case 2<a name="Test_case_2"></a></h3><div class="section"><h4>The Archetype<a name="The_Archetype"></a></h4><p>We update the first archetype by adding constraints allowing as to find the instance of type B connected to the instance of type A when created (<tt>demo2.arch</tt>):</p><div class="source"><pre class="prettyprint">&lt;cube xmlns:core=&quot;fr.liglab.adele.cube.core&quot;&gt;
  &lt;archetype id=&quot;net.debbabi.cube.demo.connect&quot; name=&quot;Connecting Components Tutorial 2&quot; version=&quot;1.0&quot;&gt;

    &lt;types&gt;
      &lt;core:component id=&quot;A&quot;/&gt;
      &lt;core:component id=&quot;B&quot;/&gt;
    &lt;/types&gt;

    &lt;constraints&gt;
      &lt;variables&gt;
        &lt;var id=&quot;va&quot; type=&quot;A&quot;/&gt;
        &lt;var id=&quot;vb&quot; type=&quot;B&quot;/&gt;
      &lt;/variables&gt;
      &lt;core:connect v1=&quot;va&quot; v2=&quot;vb&quot;/&gt;
      &lt;core:find-locally v=&quot;vb&quot; priority=&quot;1&quot;/&gt;
      &lt;core:self-create-locally v=&quot;vb&quot; priority=&quot;2&quot;/&gt;
    &lt;/constraints&gt;

  &lt;/archetype&gt;
&lt;/cube&gt;</pre></div><p>The <tt>find-locally</tt> constraint help to find an instance for the specified variable by looking on the local Runtime Model Part. While the <tt>self-create-locally</tt> find an instance by creating it locally.</p><p>Notice that we have manullay put priorities between the two constraints <tt>find-locally</tt> and <tt>self-create-locally</tt>. The priority 1 is higher than the priority 2 and so on.</p></div><div class="section"><h4>Testing<a name="Testing"></a></h4><p>You should stop your execution node before starting this new manipulation (<tt>Ctrl + c</tt>). Then, update the cube agent local configuration file to point to <tt>demo2.arch</tt> archetype instead of <tt>demo1.arch</tt>, and start the node as was explained before and do the following tests:</p><p>Create a component instance of type A three successives times.</p><div><pre>g! newi A</pre></div><p>The following images represents the visual structure of the application (provided by the internal monitoring extension) after executing each of the <tt>newi A</tt> commands. </p><img src="./images/getting_started_connect2.png" alt="connect2" /><p>In the first time (2a), Cube has analysed the archetype <tt>demo2.arch</tt> and found that the newly created instance of type A should be connected to an instance of type B. It tries to find this instance locally (using the <tt>find-locally</tt> constraints at first because it has a higher priority), and as no instance of type B already exists, it tries the second constraint <tt>self-create-locally</tt>, this last one found an instance for B (create it locally). And finaly the last constraint <tt>in-component</tt> is true in this situation.</p><p>In the second (2b) and the third (2c) times, the hight priority constraint <tt>find-locally</tt> is satisfied and so any new instance of component A is connected to this instance (<tt>B(1)</tt>).</p></div></div><div class="section"><h3>Test case 3<a name="Test_case_3"></a></h3><div class="section"><h4>The Archetype<a name="The_Archetype"></a></h4><p>Now, we update the last archetype definition by adding constraint on the B instances. This constraints (<tt>in-components</tt>) will ensure that any instance of component B should have at max a given number of input component instances. (see <tt>demo3.arch</tt>):</p><div class="source"><pre class="prettyprint">&lt;cube xmlns:core=&quot;fr.liglab.adele.cube.core&quot;&gt;
  &lt;archetype id=&quot;net.debbabi.cube.demo.connect&quot; name=&quot;Connecting Components Tutorial 3&quot; version=&quot;1.0&quot;&gt;

    &lt;types&gt;
      &lt;core:component id=&quot;A&quot;/&gt;
      &lt;core:component id=&quot;B&quot;/&gt;
    &lt;/types&gt;

    &lt;constraints&gt;
      &lt;variables&gt;
        &lt;var id=&quot;va&quot; type=&quot;A&quot;/&gt;
        &lt;var id=&quot;vb&quot; type=&quot;B&quot;/&gt;
      &lt;/variables&gt;
      &lt;core:connect v1=&quot;va&quot; v2=&quot;vb&quot;/&gt;
      &lt;core:find-locally v=&quot;vb&quot; priority=&quot;1&quot;/&gt;
      &lt;core:self-create-locally v=&quot;vb&quot; priority=&quot;2&quot;/&gt;
      &lt;core:in-components v=&quot;vb&quot; max=&quot;2&quot;/&gt;
    &lt;/constraints&gt;

  &lt;/archetype&gt;
&lt;/cube&gt;</pre></div><p>That is, when creating a component instance of type A, this last one should be connected to a component instance of type B which should exists locally and already have less that 2 input component instances. If not, create a new instance of type B.</p></div><div class="section"><h4>Testing<a name="Testing"></a></h4><p>Restart the execution node (<tt>Ctrl-C</tt>) and then update again the cube agent local configuration file to point to this new archetype file <tt>demo3.arch</tt>.</p><p>When starting the node, try the same sequence of commands as in the test case 2. That is create component instances of type A three successives times.</p><p>Here the different outputs for each time.</p><img src="./images/getting_started_connect3.png" alt="connect3" /><p>The differnce regarding the test case 2, is after the creating of the third instance of component A. Whith this new archetype, even that cube finds the already created instance of B, if this third instance of A is connected to it, the constraint <tt>in-components</tt> will not be satisfied. Hence, cube resolver tries with the next constraint <tt>self-create-locally</tt> to find the instance B, and this is why this third instance of A is connected to a new instance of B.</p></div></div><div class="section"><h3>Test case 4<a name="Test_case_4"></a></h3><div class="section"><h4>The Archetype<a name="The_Archetype"></a></h4><p>Finally, we will test the creation of a chain of components by just creating the first one (see <tt>demo4.arch</tt>).</p><div class="source"><pre class="prettyprint">&lt;cube xmlns:core=&quot;fr.liglab.adele.cube.core&quot;&gt;
  &lt;archetype id=&quot;net.debbabi.cube.demo.connect&quot; name=&quot;Connecting Components Tutorial 4&quot; version=&quot;1.0&quot;&gt;

    &lt;types&gt;
      &lt;core:component id=&quot;A&quot;/&gt;
      &lt;core:component id=&quot;B&quot;/&gt;
      &lt;core:component id=&quot;C&quot;/&gt;
      &lt;core:component id=&quot;D&quot;/&gt;
    &lt;/types&gt;

    &lt;constraints&gt;
      &lt;variables&gt;
        &lt;var id=&quot;va&quot; type=&quot;A&quot;/&gt;
        &lt;var id=&quot;vb&quot; type=&quot;B&quot;/&gt;
        &lt;var id=&quot;vc&quot; type=&quot;C&quot;/&gt;
        &lt;var id=&quot;vd&quot; type=&quot;D&quot;/&gt;
      &lt;/variables&gt;
      &lt;core:connect v1=&quot;va&quot; v2=&quot;vb&quot;/&gt;
      &lt;core:connect v1=&quot;vb&quot; v2=&quot;vc&quot;/&gt;
      &lt;core:connect v1=&quot;vc&quot; v2=&quot;vd&quot;/&gt;

      &lt;core:self-create-locally v=&quot;vb&quot;/&gt;
      &lt;core:self-create-locally v=&quot;vc&quot;/&gt;
      &lt;core:self-create-locally v=&quot;vd&quot;/&gt;
    &lt;/constraints&gt;

  &lt;/archetype&gt;
&lt;/cube&gt;</pre></div><p>when creating a component instance of type A, all the other components will be instantiated and connected as was specified on the archetype. </p></div><div class="section"><h4>Testing<a name="Testing"></a></h4><p>Restart the execution node (<tt>Ctrl-C</tt>) and then update again the cube agent local configuration file to point to this new archetype file <tt>demo4.arch</tt>.</p><p>When starting the node, just create an instances of type A and see what hapens. </p><div><pre>g! newi A</pre></div><img src="./images/getting_started_connect4.png" alt="connect4" /><p>Each instance A will create a chain of the other connected instances (B, C and D).</p><p><a href="./getting_started.html">Getting started</a> &gt;</p></div></div></div>
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2012.
          All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
